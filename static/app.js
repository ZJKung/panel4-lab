// app.js

const NUM_SMALL_IMAGES = 95; // Images 6-100 are small
const SMALL_IMAGE_START = 6; // Small images start at index 6

/**
 * Dynamically inserts the image tags into the DOM to force asset loading.
 */
function insertSmallImages() {
  const container = document.getElementById("image-container");
  const fragment = document.createDocumentFragment();

  for (let i = 0; i < NUM_SMALL_IMAGES; i++) {
    const imageNum = SMALL_IMAGE_START + i;
    // Format the index with leading zeros: e.g., '006', '010', '100'
    const index = String(imageNum).padStart(3, "0");
    const img = document.createElement("img");

    // This path matches the file names generated by image_downloader
    img.src = `/images/image_${index}_small_300x300.jpg`;
    img.alt = `Small image ${imageNum}`;
    img.className = "small-image";

    // Use the 'load' event to track when the asset is actually fully downloaded
    img.addEventListener("load", () => {
      img.classList.add("loaded");
    });

    fragment.appendChild(img);
  }

  container.appendChild(fragment);
  document.getElementById(
    "status-message"
  ).textContent = `${NUM_SMALL_IMAGES} images requested.`;
}

/**
 * Measures and logs the Time to Interactive (TTI) after the DOM is ready.
 */
function logTimingMetrics() {
  // Check for standard performance timing API
  if (window.performance && window.performance.timing) {
    // Calculate Time to Interactive (approximation)
    // domContentLoadedEventEnd measures when the DOM is ready and non-blocking scripts executed
    const tti =
      window.performance.timing.domContentLoadedEventEnd -
      window.performance.timing.navigationStart;
    document.getElementById("tti").textContent = tti;
    console.log(`[Benchmark] Time to DOM Ready (approx TTI): ${tti} ms`);
  } else {
    document.getElementById("tti").textContent = "N/A";
    console.log("[Benchmark] Performance timing API not available.");
  }
}

// Wait for the DOM to be fully parsed before executing JavaScript
document.addEventListener("DOMContentLoaded", () => {
  insertSmallImages();
  logTimingMetrics();
});
