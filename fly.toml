# fly.toml - Fly.io configuration for HTTP benchmark server
# See https://fly.io/docs/reference/configuration/ for reference

app = "http-evolution-benchmark"
primary_region = "sin"  # Singapore as primary

[build]
dockerfile = "Dockerfile"

[env]
DEPLOY_MODE = "flyio"

[http_service]
internal_port = 8080
force_https = true
auto_stop_machines = "stop"
auto_start_machines = true
min_machines_running = 1  # Keep at least 1 machine running per region for latency tests
processes = ["app"]

# Enable HTTP/2 backend - our server now supports h2c (HTTP/2 cleartext)
[http_service.http_options]
h2_backend = true

# Health check
[[http_service.checks]]
grace_period = "5s"
interval = "30s"
method = "GET"
path = "/health"
timeout = "5s"

# Machine configuration
[[vm]]
memory = "256mb"
cpu_kind = "shared"
cpus = 1
